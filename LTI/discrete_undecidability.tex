\subsection{Undecidable instances}
\label{sec:lti_undecidability}

The goal of this section is to prove the following result.

\begin{theorem}
The point-to-point controllability problem for LTI systems whose sets of admissible controls are disjoint unions of finitely many closed convex polytopes is undecidable.
\end{theorem}

\begin{proof}
We prove this by reduction from the vector reachability problem for invertible matrices (defined in~\cref{sec:matrix-undecidability}).

Let $A_{1}, \ldots, A_{k} \in \Rationals^{d \times d}$ be invertible matrices and $\myvector{x}, \myvector{y} \in \Rationals^{d}$ be non-zero vectors.

For each $i \in \lbrace 1, \ldots, k \rbrace$, we define
\begin{equation*}
B_{i} =
\begin{pmatrix}
I_{d} & 0 & 0 \\
0 & A_{i} & 0 \\
0 & 0 & A_{i}^{-1} \\
\end{pmatrix}
\end{equation*}
and $M = \diag{B_{k}, \ldots, B_{1}, I_{d}, 1} \in \mathbb{Q}^{((3k+1)d+1) \times ((3k+1)d+1)}$.

Moreover, we let, for each $i \in \lbrace 1, \ldots, k \rbrace$,
\begin{align*}
\mathcal{P}_{i}^{(1)} &= {\lbrace \boldsymbol{0} \rbrace}^{3(k-i)d} &\times
\lbrace (-\boldsymbol{z}, \boldsymbol{z}, \boldsymbol{0}, \boldsymbol{0}), \boldsymbol{z} \in \mathbb{R}^{d} \rbrace &\times
{\lbrace \boldsymbol{0} \rbrace}^{3(i-1)d} &\times \lbrace 1 \rbrace
\subseteq \mathbb{R}^{(3k+1)d+1} \\
\mathcal{P}_{i}^{(2)} &= {\lbrace \boldsymbol{0} \rbrace}^{3(k-i)d} &\times
\lbrace (-\boldsymbol{z}, \boldsymbol{0}, \boldsymbol{z}, \boldsymbol{0}), \boldsymbol{z} \in \mathbb{R}^{d} \rbrace &\times
{\lbrace \boldsymbol{0} \rbrace}^{3(i-1)d} &\times \lbrace 1 \rbrace
\subseteq \mathbb{R}^{(3k+1)d+1} \\
\mathcal{Q}_{i}^{(1)} &= {\lbrace \boldsymbol{0} \rbrace}^{3(k-i)d} &\times
\lbrace (\boldsymbol{0}, -\boldsymbol{z}, \boldsymbol{0}, \boldsymbol{z}), \boldsymbol{z} \in \mathbb{R}^{d} \rbrace &\times
{\lbrace \boldsymbol{0} \rbrace}^{3(i-1)d} &\times \lbrace 1 \rbrace
\subseteq \mathbb{R}^{(3k+1)d+1} \\
\mathcal{Q}_{i}^{(2)} &= {\lbrace \boldsymbol{0} \rbrace}^{3(k-i)d} &\times
\lbrace (\boldsymbol{0}, \boldsymbol{0}, -\boldsymbol{z}, \boldsymbol{z}), \boldsymbol{z} \in \mathbb{R}^{d} \rbrace &\times
{\lbrace \boldsymbol{0} \rbrace}^{3(i-1)d} &\times \lbrace 1 \rbrace
\subseteq \mathbb{R}^{(3k+1)d+1}.
\end{align*}
We also let $\mathcal{P}_{1} = \mathcal{P}_{i}^{(1)} \dot{\cup} \mathcal{P}_{i}^{(2)}$ and $\mathcal{Q}_{1} = \mathcal{Q}_{i}^{(1)} \dot{\cup} \mathcal{Q}_{i}^{(2)}$.
We define the set of admissible controls as
\begin{align*}
\mathcal{U} = \bigcup\limits_{i=1}^{k} \left( \mathcal{P}_{i} \dot{\cup} \mathcal{Q}_{i} \right) \dot{\cup} \lbrace \boldsymbol{0} \rbrace.
\end{align*}
Finally, defining $\boldsymbol{s} = (\boldsymbol{x}, \boldsymbol{0}, \ldots, \boldsymbol{0}, 0)$, and $\boldsymbol{t} = (\boldsymbol{0}, \ldots, \boldsymbol{0}, \boldsymbol{y}, 2k)$, it holds that $\boldsymbol{s}$ can be controlled to $\boldsymbol{t}$ if and only if there exist $n_{1}, \ldots, n_{k} \in \mathbb{Z}$ such that
\begin{equation*}
\prod\limits_{i=1}^{k}A_{i}^{n_{i}} \boldsymbol{x} = \boldsymbol{y}.
\end{equation*}

For one implication, suppose that such $n_{1}, \ldots, n_{k}$ exist.
We can use precisely $2k$ non-zero controls, which will correspond to times
$t_{1} = 0,
t_{2} = \lvert n_{1}\rvert,
t_{3} = \lvert n_{1} \rvert +1,
\ldots,
t_{2k-1} = \lvert n_{1} \rvert + \cdots + \lvert n_{k-1} \rvert + k-1,
t_{2k} = \lvert n_{1} \rvert + \cdots + \lvert n_{k} \rvert + k-1$.
For each $i \in \lbrace 0, \ldots, k-1 \rbrace$, $\myvector{u}_{t_{2i+1}}$ will belong $\mathcal{P}_{k-i}^{(1)}$ or $\mathcal{P}_{k-i}^{(2)}$ when $n_{k-i} \geq 0$ and $n_{k-i} < 0$ respectively, with
\begin{equation*}
  \myvector{z} = \prod\limits_{j=k-i+1}^{k} A_{j}^{n_{j}} \myvector{x}.
\end{equation*}
On the other hand, for each $i \in \lbrace 0, \ldots, k-1 \rbrace$, $\myvector{u}_{t_{2i+2}}$ will belong to $\mathcal{Q}_{k-i}^{(1)}$ or $\mathcal{Q}_{k-i}^{(2)}$ when $n_{k-i} \geq 0$ and $n_{k-i} < 0$ respectively, with
\begin{equation*}
  \myvector{z} = \prod\limits_{j=k-i}^{k} A_{j}^{n_{j}} \myvector{x}.
\end{equation*}
It is clear that this sequence controls $\myvector{s}$ to $\myvector{t}$.

We now proceed to showing the more challenging implication. We first note that, for any sequence controlling $\myvector{s}$ to $\myvector{t}$,
for all $i \in \lbrace 1, \ldots, k \rbrace$,
there exists $r \in \lbrace 1, 2 \rbrace$ such that both $\mathcal{P}_{i}^{(r)}$ and $\mathcal{Q}_{i}^{(r)}$ are used exactly once each
and that both $\mathcal{P}_{i}^{(3-r)}$ and $\mathcal{Q}_{i}^{(3-r)}$ are never used.
This claim is easy to prove: $\myvector{s}$ has a non-zero component in the first block (of dimension $d$), whilst $\myvector{t}$ does not,
and so we need to use an element of $\mathcal{P}_{1}$ to make that component $\myvector{0}$.
As a result of that, either the second or third block will have a non-zero component, which needs to be cleared in order to hit $\myvector{t}$,
and therefore an element of $\mathcal{Q}_{1}$ needs to be used. Afterwards, we will have a non-zero component in the fourth block,
which again needs to be cleared (unless $k=1$, of course). The same argument can then be applied inductively.
That each $\mathcal{P}_{i}$ and each $\mathcal{Q}_{i}$ can only be used once follows from the fact that we can only use $2k$ controls over all,
and that each needs to be used at least once.

We suppose, for notational simplicity and without loss of generality (as $A_{i}$ and $A_{i}^{-1}$ can be exchanged),
that all used controls come from the $\mathcal{P}_{i}^{(1)}$ and $\mathcal{Q}_{i}^{(1)}$.
We also suppose that these controls are taken with $\myvector{z}=\myvector{u}_{i}$ and $\myvector{z}=\myvector{v}_{i}$ respectively
(the reader may refer to the definition of the control set for clarifying this notation).
After the controls are applied (whatever their order), for some $n_{1}, m_{1}, \ldots, n_{k}, m_{k} \in \Integers$, we will be the following state:
\begin{equation*}
  \left(
  -\myvector{u}_{k}, A_{k}^{n_{k}} \myvector{u}_{k} - A_{k}^{m_{k}} \myvector{v}_{k}, \myvector{0}, \myvector{v}_{k} - \myvector{u}_{k-1},
  \ldots,
  \myvector{v}_{2} - \myvector{u}_{1}, A_{1}^{n_{1}} \myvector{u}_{1} - A_{1}^{m_{1}} \myvector{v}_{1}, \myvector{0}, \myvector{v}_{1},
  2k
  \right).
\end{equation*}

For this to be equal to $\myvector{t}$, the following needs to hold:
\begin{equation*}
  \myvector{y} = \myvector{v}_{1} = A_{1}^{n_{1} - m_{1}} \myvector{u}_{1} = A_{1}^{n_{1} - m_{1}} \myvector{v}_{2} =
  A_{1}^{n_{1} - m_{1}} A_{2}^{n_{2} - m_{2}} \myvector{u}_{2} = \cdots = \prod\limits_{i=1}^{k} A_{i}^{n_{i} - m_{i}} \myvector{x}.
\end{equation*}
This concludes our proof.
\end{proof}
